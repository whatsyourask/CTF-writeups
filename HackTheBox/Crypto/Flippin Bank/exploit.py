from pwn import *
import binascii



def exploit(ip, port, flip, char, position):
    r = remote(ip, port)
    r.recv()
    login = 'admin'
    if position < 5:
        arr = list(login)
        print(login)
        arr[position] = char
        login = ''.join(arr)
        login = login.encode()
        print(login)
    r.sendline(login)
    password = b'g0ld3n_b0y'
    r.recv()
    r.sendline(password)
    r.recvuntil('Leaked ciphertext: ')
    hex_leak = r.recv().decode().split('\n')[0]
    leak = binascii.unhexlify(hex_leak)
    #print(leak)
    ind = position
    first_byte = leak[ind]
    #print(first_byte)
    first_byte ^= flip
    first_byte = chr(first_byte).encode()
    #print(first_byte)
    #print(first_byte)
    if position < 1:
        new_data = first_byte + leak[1:]
    else:
        new_data = leak[:ind - 1] + first_byte + leak[ind + 1:]
    if len(new_data) > 48:
        r.close()
        return
    #print(len(new_data))
    new_data = binascii.hexlify(new_data)
    #print(new_data)
    r.send(new_data)
    response = r.recv()
    print(response)
    if b'success' in response:
        r.close()
        exit()
    r.close()


def main():
    #ip = '127.0.0.1'
    #port = 1337
    ip = '188.166.169.77'
    port = 31793
    for position in range(0, 10):
        for char in range(33, 126):
            for i in range(100):
                exploit(ip, port, i, chr(char), position)


if __name__=='__main__':
    main()
