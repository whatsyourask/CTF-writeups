from pwn import *
from random import randint


def exploit():
    s = ssh(user='input2', host='pwnable.kr', password='guest', port=2222)
    argv = pass_stage1()
    p = s.process(argv, stderr=process.PIPE)
    print(p.recv().decode('utf-8'))


def pass_stage1():
    # Function to pass stage one
    # Generate the argv for process
    argv = [p8(0x90) for i in range(100)]
    # First argument is name of program which process will execute
    argv[0] = './input'
    # From source code we have two conditions:
    argv[ord('A')] = p8(0x00)
    argv[ord('B')] = p8(0x20) + p16(0x0d0a)
    return argv


def pass_stage2(p, s):
    # Function to pass stage two
    # Create first step in bypass
    payload  = p32(0xff000a00)
    # Second step
    payload2 = p32(0xff020a00)
    # Just for fun i will create a file with random name
    number = str(randint(0, 1000)).encode()
    # I use sha1 to reduce the likelihood of this filename
    filename = sha1sumhex(number)
    # Test print
    print(filename)


if __name__=='__main__':
    pass_stage2(0, 1)
